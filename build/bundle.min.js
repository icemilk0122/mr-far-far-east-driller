!function e(t,a,i){function r(n,s){if(!a[n]){if(!t[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(o)return o(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var c=a[n]={exports:{}};t[n][0].call(c.exports,function(e){var a=t[n][1][e];return r(a||e)},c,c.exports,e,t,a,i)}return a[n].exports}for(var o="function"==typeof require&&require,n=0;n<i.length;n++)r(i[n]);return r}({1:[function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=e("./states/boot"),o=i(r),n=e("./states/game"),s=i(n),l=e("./states/menu"),h=i(l),c=e("./states/preloader"),u=i(c),f=e("./states/gameover"),d=i(f),g=new Phaser.Game(window.innerWidth,window.innerHeight,Phaser.AUTO,"mr-far-far-east-driller-game");g.state.add("boot",new o.default),g.state.add("game",new s.default),g.state.add("menu",new h.default),g.state.add("preloader",new u.default),g.state.add("gameover",new d.default),g.state.start("boot")},{"./states/boot":3,"./states/game":4,"./states/gameover":5,"./states/menu":6,"./states/preloader":7}],2:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=function(e){function t(e,a,o,n){i(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,o,"lava",n));return s.anchor.setTo(.5,.5),s.animations.add("filling",[0,1,2],2,!1).onComplete.add(function(){this.play("full")},s),s.animations.add("full",[3,4,5],1,!0),s.animations.stop(),s.animations.play("filling"),s}return o(t,e),n(t,[{key:"update",value:function(){this.y<this.game.camera.y-this.game.global.blockHeight&&this.kill(),this.alive&&this.animations.getAnimation("full").isPlaying&&(this.lethal=!0,this.canMoveRight=!0,this.canMoveLeft=!0,this.canMoveDown=!0,this.game.ground.forEachAlive(function(e){e.y==this.y&&e.x==this.x+this.game.global.blockWidth&&(this.canMoveRight=!1),e.y==this.y&&e.x==this.x-this.game.global.blockWidth&&(this.canMoveLeft=!1),e.x==this.x&&e.y==this.y+this.game.global.blockHeight&&(this.canMoveDown=!1)},this),this.game.lava.forEachAlive(function(e){e.y==this.y&&e.x==this.x+this.game.global.blockWidth&&(this.canMoveRight=!1),e.y==this.y&&e.x==this.x-this.game.global.blockWidth&&(this.canMoveLeft=!1),e.x==this.x&&e.y==this.y+this.game.global.blockHeight&&(this.canMoveDown=!1)},this),this.canMoveRight&&this.x<this.game.width-this.game.global.blockWidth/2&&this.game.lava.add(new t(this.game,this.x+this.game.global.blockWidth,this.y)),this.canMoveLeft&&this.x>this.game.global.blockWidth/2&&this.game.lava.add(new t(this.game,this.x-this.game.global.blockWidth,this.y)),this.canMoveDown&&this.y<this.game.camera.y+this.game.camera.height&&this.game.lava.add(new t(this.game,this.x,this.y+this.game.global.blockHeight)))}}]),t}(Phaser.Sprite);a.default=s},{}],3:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),n(t,[{key:"preload",value:function(){this.load.image("preloader","assets/preloader.gif")}},{key:"create",value:function(){this.game.input.maxPointers=1,this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.physics.arcade.gravity.y=1e3,this.game.time.advancedTiming=!0,this.game.device.desktop,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.refresh(),this.game.world.setBounds(0,0,this.game.width),this.initGlobalVariables(),this.game.air_console=new AirConsole;var e=this.game,t=0;this.game.air_console.onConnect=function(a){0==t&&e.air_console.getControllerDeviceIds().length>=2&&(e.air_console.setActivePlayers(2),t=e.air_console.getActivePlayerDeviceIds().length)},this.game.state.start("preloader")}},{key:"initGlobalVariables",value:function(){this.game.global={drillLen:2,blockHeight:64,blockWidth:64,player1Score:0,player2Score:0}}}]),t}(Phaser.State);a.default=s},{}],4:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=e("../prefabs/lava"),l=function(e){return e&&e.__esModule?e:{default:e}}(s),h=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.blockHeight=64,e.blockWidth=64,e.middle=10*e.blockHeight,e.drillArr=[],e.controls={p0:[Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.DOWN],p1:[Phaser.Keyboard.A,Phaser.Keyboard.D,Phaser.Keyboard.S]},e}return o(t,e),n(t,[{key:"create",value:function(){this.game.camera.reset(),this.createGround(),this.createDriller(),this.game.p0action="stop",this.game.p1action="stop";var e=this;this.game.air_console.onMessage=function(t,a){switch(a){case"left":e.game["p"+e.game.air_console.convertDeviceIdToPlayerNumber(t)+"action"]="left";break;case"right":e.game["p"+e.game.air_console.convertDeviceIdToPlayerNumber(t)+"action"]="right";break;case"down":e.game["p"+e.game.air_console.convertDeviceIdToPlayerNumber(t)+"action"]="down";break;case"stop":e.game["p"+e.game.air_console.convertDeviceIdToPlayerNumber(t)+"action"]="stop"}}}},{key:"update",value:function(){this.game.physics.arcade.collide(this.drillArr[0],this.drillArr[1]),this.game.physics.arcade.collide(this.drillArr,this.game.ground);for(var e=0;e<this.drillArr.length;e++)this.game.tweens.isTweening(this.drillArr[e])||this.move(this.drillArr[e]),this.drillArr[e].alive&&this.drillmove(this.drillArr[e]),this.game.lava.forEachAlive(function(t){t.lethal&&this.game.math.distance(this.drillArr[e].x,this.drillArr[e].y,t.x,t.y)<this.blockWidth/2&&(this.drillArr[e].kill(),0==this.game.driller.countLiving()&&this.game.state.start("gameover"))},this)}},{key:"collisionHandler",value:function(e,t){this.game.stage.backgroundColor="#992d2d"}},{key:"endGame",value:function(){this.game.state.start("gameover")}},{key:"move",value:function(e){"left"==this.game["p"+e.id+"action"]&&e.x>this.blockWidth/2?(this.game.add.tween(e).to({x:e.x-this.blockWidth},this.drillMoveSpeed,Phaser.Easing.Sinusoidal.InOut,!0),e.animations.play("left")):"right"==this.game["p"+e.id+"action"]&&e.x<this.game.width-this.blockWidth/2?(this.game.add.tween(e).to({x:e.x+this.blockWidth},this.drillMoveSpeed,Phaser.Easing.Sinusoidal.InOut,!0),e.animations.play("right")):"down"==this.game["p"+e.id+"action"]&&(this.game.add.tween(e).to({y:e.y+this.blockHeight},this.drillMoveSpeed,Phaser.Easing.Sinusoidal.InOut,!0),this.addMoreGround(),e.animations.play("down"),this.depth++,this.game.driller.forEachAlive(function(e){e!=this.game.camera.target&&e.y>this.game.camera.target.y&&this.game.camera.follow(e)},this))}},{key:"drillmove",value:function(e){this.game.ground.forEachAlive(function(t){this.game.math.distance(e.x,e.y,t.x,t.y)<.8*this.blockWidth&&(t.animations.getAnimation("crush").isPlaying||(t.tween=this.game.add.tween(t).to({alpha:0},180,Phaser.Easing.Cubic.In,!0),t.animations.play("crush"),this.game.global["player"+(e.id+1)+"Score"]+=1)),t.y<this.game.camera.y-this.blockHeight&&t.kill()},this)}},{key:"createDriller",value:function(){this.game.driller=this.game.add.group();for(var e=0;e<this.game.global.drillLen;e++){var t=this.game.driller.getFirstDead();null===t&&(t=this.game.add.sprite(1.5*this.blockWidth*(2*e+1),this.middle,"drill"+e,0,this.game.driller),t.id=e,t.anchor.setTo(.5,.5),t.animations.add("right",[0,1,2],10,!0),t.animations.add("left",[3,4,5],10,!0),t.animations.add("down",[6,7,8],10,!0),t.animations.add("up",[9,10,11],10,!0),t.animations.play("right")),t.reset(1.5*this.blockWidth*(2*e+1),this.middle),t.frame=0,t.alpha=1,t.revive(),this.game.physics.arcade.enable(t),this.drillArr.push(t)}this.game.camera.follow(this.game.driller.getFirstAlive())}},{key:"createGround",value:function(){this.groundDepth=this.middle+this.blockHeight,this.game.ground=this.game.add.group(),this.game.lava=this.game.add.group(),this.game.firsttime=!0,this.addMoreGround()}},{key:"createLava",value:function(e,t,a){var i=this.game.lava.getFirstDead();null===i?i=this.game.lava.add(new l.default(e,t,a)):(i.reset(t,a),i.lethal=!1,i.revive(),i.animations.stop(),i.animations.play("filling"))}},{key:"addMoreGround",value:function(){var e,t,a=this.game.firsttime?10:1;for(this.game.firsttime=!1,e=.5*this.blockWidth;e<this.game.width+this.blockWidth;e+=this.blockWidth)for(t=this.groundDepth;t<this.groundDepth+this.blockHeight*a;t+=this.blockHeight){var i=Phaser.Utils.chanceRoll(10);if(i&&t>=Math.max(this.groundDepth,this.middle+2*this.blockHeight))this.createLava(this.game,e,t);else{var r=this.game.ground.getFirstDead();if(null===r){r=this.game.add.sprite(e,t,"ground",0,this.game.ground),r.anchor.setTo(.5,.5);var o=r.animations.add("crush",[0,1,2,3],20,!1);o.killOnComplete=!0}r.reset(e,t),r.frame=0,r.alpha=1,r.revive(),this.game.physics.arcade.enable(r),r.body.allowGravity=!1,r.body.immovable=!0}}this.groundDepth=t}},{key:"render",value:function(){this.game.debug.text(this.game.time.fps||"--",2,14,"#00ff00"),this.game.debug.text("lava living:"+this.game.lava.countLiving(),2,28),this.game.debug.text("ground living:"+this.game.ground.countLiving(),2,42),this.game.debug.text(this.game.global.player1Score,2,56),this.game.debug.text(this.game.global.player2Score,2,70)}}]),t}(Phaser.State);a.default=h},{"../prefabs/lava":2}],5:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),n(t,[{key:"create",value:function(){this.add.text(this.game.width/this.game.global.drillLen*.5,.5*this.game.height-100,"1P\n"+1e3*this.game.global.player1Score+"億",{font:"42px Arial",fill:"#ffffff",align:"center"}).anchor.set(.5),this.add.text(this.game.width/this.game.global.drillLen*1.5,.5*this.game.height-100,"2P\n"+1e3*this.game.global.player2Score+"億",{font:"42px Arial",fill:"#ffffff",align:"center"}).anchor.set(.5);for(var e=0;e<this.game.global.drillLen;e++){var t=this.add.sprite(this.game.width/this.game.global.drillLen*(e+.5),.5*this.game.height,"drill"+e);t.anchor.setTo(.5,.5),t.animations.add("right",[0,1,2],10,!0),t.animations.play("right")}this.saveVarsToLocalStorage();var a=this;this.game.air_console.onMessage=function(e,t){if(0==a.game.air_console.convertDeviceIdToPlayerNumber(e))switch(t){case"A":a.restartGame()}}}},{key:"saveVarsToLocalStorage",value:function(){}},{key:"resetGlobalVariables",value:function(){this.game.global.player1Score=0,this.game.global.player2Score=0}},{key:"update",value:function(){}},{key:"restartGame",value:function(){this.resetGlobalVariables(),this.game.state.start("menu")}}]),t}(Phaser.State);a.default=s},{}],6:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),n(t,[{key:"create",value:function(){this.add.text(.5*this.game.width,.5*this.game.height-100,"FARFAREAST DRILLER",{font:"42px Arial",fill:"#ffffff",align:"center"}).anchor.set(.5),this.add.text(.5*this.game.width,.5*this.game.height,"START",{font:"42px Arial",fill:"#ffffff",align:"center"}).anchor.set(.5);var e=this;this.game.air_console.onMessage=function(t,a){if(0==e.game.air_console.convertDeviceIdToPlayerNumber(t))switch(a){case"A":e.startGame()}}}},{key:"startGame",value:function(){this.game.state.start("game")}},{key:"update",value:function(){}}]),t}(Phaser.State);a.default=s},{}],7:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),s=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.asset=null,e.ready=!1,e}return o(t,e),n(t,[{key:"preload",value:function(){this.asset=this.add.sprite(.5*this.game.width-110,.5*this.game.height-10,"preloader"),this.load.setPreloadSprite(this.asset),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.loadResources()}},{key:"update",value:function(){this.ready&&this.game.state.start("menu")}},{key:"loadResources",value:function(){this.game.load.spritesheet("ground","assets/sprites/ground.png",64,64),this.game.load.spritesheet("lava","assets/sprites/lava.png",64,64),this.game.load.spritesheet("drill0","assets/sprites/drill.png",64,64),this.game.load.spritesheet("drill1","assets/sprites/drill2.png",64,64)}},{key:"onLoadComplete",value:function(){this.ready=!0}}]),t}(Phaser.State);a.default=s},{}]},{},[1]);
